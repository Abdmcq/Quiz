<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>

    <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-236N37LHFR"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-236N37LHFR');
</script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>تشخيص صور الباطنية - الفاينل</title>
    <!-- تحميل مكتبة Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- خط Cairo للغة العربية و Inter للوجو الإنجليزي -->
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&family=Inter:wght@900&display=swap');
        body {
            font-family: 'Cairo', sans-serif;
            background-color: #f3f4f6; /* خلفية رمادية فاتحة */
        }
        .logo-font {
            font-family: 'Inter', sans-serif;
        }

        /* تنسيق خاص للوحة البداية */
        .typing-container {
            --chars: 17; /* طول النص: "Abdulrahman Hasan" */
            width: calc(var(--chars) * 1ch); /* عرض النص الكامل */
            overflow: hidden;
            white-space: nowrap;
            display: inline-block;
            border-right: .15em solid #4F46E5; /* المؤشر الوامض بلون Indigo */
            
            /* دورة مستمرة: كتابة -> توقف -> مسح */
            animation: type-delete-cycle 8s steps(var(--chars)) infinite, 
                       blink 0.5s step-end infinite;
        }

        @keyframes type-delete-cycle {
            /* 0% - 40%: Typing */
            0% { width: 0; } 
            40% { width: calc(var(--chars) * 1ch); } 
            
            /* 40% - 60%: Pause */
            60% { width: calc(var(--chars) * 1ch); } 

            /* 60% - 100%: Deleting (and back to 0% for restart) */
            100% { width: 0; } 
        }
        
        @keyframes blink {
            from, to { border-color: transparent }
            50% { border-color: #4F46E5; }
        }

        /* تخصيص شريط التقدم ليكون متناسقاً مع لون المشغل */
        input[type="range"]::-webkit-slider-thumb {
            background: #14B8A6; /* Teal-500 */
        }
        input[type="range"]::-moz-range-thumb {
            background: #14B8A6; /* Teal-500 */
        }
        .accent-teal-500 {
            accent-color: #14B8A6; /* Teal-500 */
        }
    </style>
</head>
<body class="min-h-screen flex flex-col">

    <!-- العنصر الرئيسي الذي يحمل جميع الشاشات -->
    <div id="app" class="flex-grow flex flex-col">
        <!-- يتم تحميل محتوى الشاشات هنا بواسطة JavaScript -->
    </div>

    <!-- شريط الحقوق الثابت في الأسفل -->
    <footer class="bg-gray-800 text-white text-center p-3 text-sm">
        <p>اعداد عبدالرحمن حسن</p>
    </footer>

    <script>
        // قائمة التشغيل للأغاني
        const playlist = [
            { id: 1, src: "https://files.catbox.moe/q2lyxo.mp3", title: "راغب علامة & اليسا" },
            { id: 2, src: "https://files.catbox.moe/xbgi3g.mp3", title: "احلفك بالمحبة" },
            { id: 3, src: "https://files.catbox.moe/0l8qga.mp3", title: "يا هوى روح - وائل كافوري" },
            { id: 4, src: "https://files.catbox.moe/t5x3ri.mp3", title: "وائل كافوري" },
            { id: 5, src: "https://files.catbox.moe/i7huol.mp3", title: "نانسي عجرم" },
            { id: 6, src: "https://files.catbox.moe/nvbzlz.mp3", title: "هيثم يوسف" }
        ];

        // بيانات الاختبار (تم التحديث بناءً على طلبك)
        const quizData = [
            { id: 1, image: "https://i.postimg.cc/jjwKqZNj/EUI_OIU_001.jpg", correctDiagnosis: "Jaundice" },
            { id: 2, image: "https://i.postimg.cc/GpWR4GJH/EUI_OIU_002.jpg", correctDiagnosis: "Caput medusae" },
            { id: 3, image: "https://i.postimg.cc/ZqGmWpFB/EUI_OIU_003.jpg", correctDiagnosis: "Gynecomastia" },
            { id: 4, image: "https://i.postimg.cc/GpWR4GJs/EUI_OIU_004.jpg", correctDiagnosis: "Palmar erythema" },
            { id: 5, image: "https://i.postimg.cc/s2kzM79B/EUI_OIU_005.jpg", correctDiagnosis: "Normal duodenum" },
            { id: 6, image: "https://i.postimg.cc/cJpWvwMY/EUI_OIU_006.jpg", correctDiagnosis: "Normal duodenum" },
            { id: 7, image: "https://i.postimg.cc/PqgHCYzQ/EUI_OIU_007.jpg", correctDiagnosis: "duodenum ulcer" },
            { id: 8, image: "https://i.postimg.cc/sX5r7xwp/EUI_OIU_008.jpg", correctDiagnosis: "Duodenal bulb" },
            { id: 9, image: "https://i.postimg.cc/d1GYr34R/EUI_OIU_009.jpg", correctDiagnosis: "Gastric ulcer" },
            { id: 10, image: "https://i.postimg.cc/pTKHzrqB/EUI_OIU_010.jpg", correctDiagnosis: "Gastric ulcer" },
            { id: 11, image: "https://i.postimg.cc/85LSMctm/EUI_OIU_011.jpg", correctDiagnosis: "Gastric ulcer" },
            { id: 12, image: "https://i.postimg.cc/xCL2M8t4/EUI_OIU_012.jpg", correctDiagnosis: "Gastric ulcer" },
            { id: 13, image: "https://i.postimg.cc/1tDQwXJk/EUI_OIU_013.jpg", correctDiagnosis: "Polycystic kidney" },
            { id: 14, image: "https://i.postimg.cc/nzqJBr3b/EUI_OIU_014.jpg", correctDiagnosis: "Bilateral renal stones" },
            { id: 15, image: "https://i.postimg.cc/xCL2M86V/EUI_OIU_015.jpg", correctDiagnosis: "Prostatic hypertrophy" },
            { id: 16, image: "https://i.postimg.cc/pTKHzrsH/EUI_OIU_016.jpg", correctDiagnosis: "myocardial infarction" },
            { id: 17, image: "https://i.postimg.cc/FzmQZv69/EUI_OIU_017.jpg", correctDiagnosis: "myocardial infarction" },
            { id: 18, image: "https://i.postimg.cc/kG9dcCH7/EUI_OIU_018.jpg", correctDiagnosis: "Atherosclerosis" },
            { id: 19, image: "https://i.postimg.cc/QCbZYPLx/EUI_OIU_021.jpg", correctDiagnosis: "Prinzmetal angine" },
            { id: 20, image: "https://i.postimg.cc/qq0dLrFC/EUI_OIU_019.jpg", correctDiagnosis: "Normal Sinus Rhythm" },
            { id: 21, image: "https://i.postimg.cc/nrZtkxWz/EUI_OIU_020.jpg", correctDiagnosis: "Angina Pectoris" },
            { id: 22, image: "https://i.postimg.cc/J0qCYgwH/EUI_OIU_022.jpg", correctDiagnosis: "ST depression (Angina pectoris)" },
            { id: 23, image: "https://i.postimg.cc/Znczsgkx/EUI_OIU_023.jpg", correctDiagnosis: "ST Elevation" },
            { id: 24, image: "https://i.postimg.cc/VvRPZTyB/EUI_OIU_024.png", correctDiagnosis: "Sinus Tachycardia" },
            { id: 25, image: "https://i.postimg.cc/2ywN9Jpw/EUI_OIU_025.png", correctDiagnosis: "Sinus Bradycardia" },
            { id: 26, image: "https://i.postimg.cc/qBXr7ttH/EUI_OIU_026.jpg", correctDiagnosis: "Atrial ectopic" },
            { id: 27, image: "https://i.postimg.cc/wxczBttH/EUI_OIU_029.jpg", correctDiagnosis: "Atrial ectopic" },
            { id: 28, image: "https://i.postimg.cc/RCQm033z/EUI_OIU_027.jpg", correctDiagnosis: "Atrial fibrillation" },
            { id: 29, image: "https://i.postimg.cc/Y2f7S44H/EUI_OIU_028.jpg", correctDiagnosis: "Supra Ventricular Tachycardia" },
            { id: 30, image: "https://i.postimg.cc/NG7t0yy0/EUI_OIU_030.jpg", correctDiagnosis: "Ventricular Ectopic" },
            { id: 31, image: "https://i.postimg.cc/v8Lym11T/EUI_OIU_031.jpg", correctDiagnosis: "Ventricular Ectopic (Bigemeni)" },
            { id: 32, image: "https://i.postimg.cc/Y2f7S44v/EUI_OIU_032.jpg", correctDiagnosis: "Ventricular Tachycardia" },
            { id: 33, image: "https://i.postimg.cc/3rChwyyG/EUI_OIU_033.jpg", correctDiagnosis: "first degree heart block" },
            { id: 34, image: "https://i.postimg.cc/05dvN66w/EUI_OIU_034.jpg", correctDiagnosis: "Type-1 second degree Heart block" },
            { id: 35, image: "https://i.postimg.cc/ryCTpddW/EUI_OIU_035.jpg", correctDiagnosis: "Type-2 second degree Heart block" },
            { id: 36, image: "https://i.postimg.cc/tCqjnXPV/EUI_OIU_036.jpg", correctDiagnosis: "3rd degree (complete heart block)" },
            { id: 37, image: "https://i.postimg.cc/qMJT6knY/EUI_OIU_037.png", correctDiagnosis: "Right bundle branch block" },
            { id: 38, image: "https://i.postimg.cc/65MNdDLM/EUI_OIU_038.png", correctDiagnosis: "left bundle branch block" },
            { id: 39, image: "https://i.postimg.cc/Kv0yndrQ/EUI_OIU_039.jpg", correctDiagnosis: "Sick Sinus Syndrome" },
            { id: 40, image: "https://i.postimg.cc/xT6SKWys/EUI_OIU_040.jpg", correctDiagnosis: "Tonsillitis" },
            { id: 41, image: "https://i.postimg.cc/8PZVhqBn/EUI_OIU_041.jpg", correctDiagnosis: "Diphtheria" },
            { id: 42, image: "https://i.postimg.cc/Wb5PMQwc/EUI_OIU_042.jpg", correctDiagnosis: "Bilateral Pneumonia" },
            { id: 43, image: "https://i.postimg.cc/8PZVhqmz/EUI_OIU_043.jpg", correctDiagnosis: "Lobar Pneumonia" },
            { id: 44, image: "https://i.postimg.cc/65MNdDfX/EUI_OIU_044.jpg", correctDiagnosis: "KUB renal stone" },
            { id: 45, image: "https://i.postimg.cc/SNgpWwfN/EUI_OIU_045.jpg", correctDiagnosis: "Intravenous pyelogram" },
            { id: 46, image: "https://i.postimg.cc/JztCKPpm/EUI_OIU_046.jpg", correctDiagnosis: "CT-scan of renal system" },
            { id: 47, image: "https://i.postimg.cc/QdVZS0fX/EUI_OIU_047.jpg", correctDiagnosis: "CT-scan of renal system" },
            { id: 48, image: "https://i.postimg.cc/CxdpJmcw/EUI_OIU_048.jpg", correctDiagnosis: "KUB Vesical stone" },
            { id: 49, image: "https://i.postimg.cc/x1qVgt6f/EUI_OIU_049.jpg", correctDiagnosis: "esophagogastric junction zline" },
            { id: 50, image: "https://i.postimg.cc/RZqxGXgq/EUI_OIU_051.jpg", correctDiagnosis: "gastric antrum – normal" },
            { id: 51, image: "https://i.postimg.cc/JztCKPpy/EUI_OIU_052.jpg", correctDiagnosis: "Normal Stomach" },
            { id: 52, image: "https://i.postimg.cc/W1tcSX5z/EUI_OIU_050.jpg", correctDiagnosis: "esophagogastric junction zline" }
        ];

        let results = {}; // لحفظ نتائج التشخيص
        const appDiv = document.getElementById('app');
        
        // متغيرات مشغل الموسيقى
        let audioPlayer = new Audio();
        let currentTrackIndex = 0;
        let isPlayerInitialized = false;
        
        // دالة لخلط عناصر المصفوفة (لمنع التسلسل)
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }

        // ----------------------------------------------------------------
        // وظائف مشغل الموسيقى
        // ----------------------------------------------------------------

        function initializeAudioPlayer() {
            if (isPlayerInitialized) return;
            audioPlayer.src = playlist[currentTrackIndex].src;
            audioPlayer.addEventListener('loadedmetadata', updatePlayerUI);
            audioPlayer.addEventListener('ended', playNext);
            audioPlayer.addEventListener('timeupdate', () => {
                const currentTimeDisplay = document.getElementById('currentTime');
                const progressBar = document.getElementById('progressBar');
                if (currentTimeDisplay) currentTimeDisplay.textContent = formatTime(audioPlayer.currentTime);
                if (progressBar && !isNaN(audioPlayer.duration) && audioPlayer.duration > 0) {
                    const percentage = (audioPlayer.currentTime / audioPlayer.duration) * 100;
                    progressBar.value = percentage;
                }
            });
            audioPlayer.addEventListener('play', updatePlayerUI);
            audioPlayer.addEventListener('pause', updatePlayerUI);
            isPlayerInitialized = true;
        }

        function updatePlayerUI() {
            const trackTitle = document.getElementById('trackTitle');
            const playPauseButton = document.getElementById('playPauseButton');
            const durationDisplay = document.getElementById('duration');
            if (trackTitle) trackTitle.textContent = playlist[currentTrackIndex].title;
            if (durationDisplay && !isNaN(audioPlayer.duration)) durationDisplay.textContent = formatTime(audioPlayer.duration);
            if (playPauseButton) {
                playPauseButton.innerHTML = audioPlayer.paused ? 
                    `<svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24"><path d="M6 19L18 12L6 5V19Z"/></svg>` :
                    `<svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24"><path d="M6 19H8V5H6V19ZM16 5V19H18V5H16Z"/></svg>`;
            }
        }
        
        function togglePlayPause() {
            if (audioPlayer.paused) {
                audioPlayer.play().catch(e => console.error("Error playing audio:", e));
            } else {
                audioPlayer.pause();
            }
            updatePlayerUI();
        }

        function playNext() {
            audioPlayer.pause();
            currentTrackIndex = (currentTrackIndex + 1) % playlist.length;
            audioPlayer.src = playlist[currentTrackIndex].src;
            audioPlayer.load();
            audioPlayer.play().catch(e => console.error("Error playing audio:", e));
            updatePlayerUI();
        }

        function playPrev() {
            audioPlayer.pause();
            currentTrackIndex = (currentTrackIndex - 1 + playlist.length) % playlist.length; 
            audioPlayer.src = playlist[currentTrackIndex].src;
            audioPlayer.load();
            audioPlayer.play().catch(e => console.error("Error playing audio:", e));
            updatePlayerUI();
        }

        function seek(value) {
            if (!isNaN(audioPlayer.duration)) audioPlayer.currentTime = (value / 100) * audioPlayer.duration;
        }
        
        function skipTime(time) {
            audioPlayer.currentTime += time;
        }

        function formatTime(seconds) {
            const min = Math.floor(seconds / 60);
            const sec = Math.floor(seconds % 60);
            return `${min}:${sec < 10 ? '0' : ''}${sec}`;
        }
        
        // ----------------------------------------------------------------
        // 1. شاشة البوابة (Gate Screen)
        // ----------------------------------------------------------------

        function renderGateScreen() {
            if (isPlayerInitialized && !audioPlayer.paused) audioPlayer.pause();
            const typingText = "Abdulrahman Hasan"; 
            appDiv.innerHTML = `
                <div class="flex-grow flex items-center justify-center p-4">
                    <div class="bg-white shadow-2xl rounded-xl p-8 max-w-sm md:max-w-md w-full text-center border-t-4 border-indigo-600">
                        <div class="mb-8 h-6 flex justify-center">
                            <h2 class="text-xl text-indigo-700 font-extrabold logo-font typing-container">${typingText}</h2>
                        </div>
                        <h1 class="text-2xl md:text-3xl font-extrabold text-gray-800 mb-6 leading-relaxed">
                            يارب ينجح عبدالرحمن حسن بالفاينل
                        </h1>
                        <div class="space-y-4 mb-8">
                            <button onclick="renderQuizScreen()" class="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-4 rounded-lg transition duration-300 transform hover:scale-[1.02] shadow-lg">
                                آمين (للدخول)
                            </button>
                            <button onclick="renderFailureScreen()" class="w-full bg-red-600 hover:bg-red-700 text-white font-bold py-3 px-4 rounded-lg transition duration-300 transform hover:scale-[1.02] shadow-lg">
                                ان شاء الله ماينجح
                            </button>
                        </div>
                        <div class="pt-4 border-t border-gray-200">
                            <h3 class="text-base font-bold text-gray-700 mb-4">للاستفسارات :</h3>
                            <div class="flex flex-wrap justify-center gap-3 text-sm">
                                <a href="https://t.me/ll7ddd" target="_blank" class="flex items-center p-2 bg-indigo-100 rounded-full hover:bg-indigo-200 transition duration-150 shadow-sm">
                                    <span class="font-semibold text-gray-800 tracking-wide">@ll7ddd</span>
                                </a>
                                <a href="https://t.me/ans24h" target="_blank" class="flex items-center p-2 bg-indigo-100 rounded-full hover:bg-indigo-200 transition duration-150 shadow-sm">
                                    <span class="font-semibold text-gray-800">القناة: @ans24h</span>
                                </a>
                                <a href="https://t.me/Ans2co1bot" target="_blank" class="flex items-center p-2 bg-indigo-100 rounded-full hover:bg-indigo-200 transition duration-150 shadow-sm">
                                    <span class="font-semibold text-gray-800">البوت: @Ans2co1bot</span>
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        // ----------------------------------------------------------------
        // 2. شاشة الرفض (Failure Screen)
        // ----------------------------------------------------------------

        function renderFailureScreen() {
            if (isPlayerInitialized && !audioPlayer.paused) audioPlayer.pause();
            appDiv.innerHTML = `
                <div class="flex-grow flex items-center justify-center p-4">
                    <div class="bg-white shadow-xl rounded-xl p-8 max-w-md w-full text-center border-t-4 border-red-600">
                        <svg class="mx-auto h-16 w-16 text-red-500 mb-4 animate-pulse" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.332 16c-.77 1.333.192 3 1.732 3z"/>
                        </svg>
                        <h1 class="text-3xl font-extrabold text-red-700 mb-4">للأسف!</h1>
                        <p class="text-xl text-gray-700 mb-6">ارجع افتح الموقع مرة ثانية واختار آمين</p>
                        <button onclick="renderGateScreen()" class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-6 rounded-lg transition duration-300 shadow-md">العودة إلى البداية</button>
                    </div>
                </div>
            `;
        }

        // ----------------------------------------------------------------
        // 3. شاشة الاختبار الرئيسية (Quiz Screen)
        // ----------------------------------------------------------------

        function renderQuizScreen() {
            initializeAudioPlayer();
            shuffleArray(quizData); 
            let quizHTML = quizData.map((item, index) => `
                <div id="card-${item.id}" class="bg-white shadow-lg rounded-xl p-5 mb-8 transition-shadow duration-300 hover:shadow-xl border border-gray-100">
                    <h2 class="text-xl font-semibold text-indigo-700 mb-4 border-b pb-2">الصورة رقم #${index + 1}</h2>
                    <div class="w-full flex justify-center mb-6">
                        <img src="${item.image}" alt="صورة تشخيص" class="rounded-lg shadow-md max-w-full h-auto object-cover" onerror="this.src='https://placehold.co/400x300?text=Image+Not+Found'">
                    </div>
                    <div class="mb-4">
                        <label for="diagnosis-${item.id}" class="block text-gray-700 font-medium mb-2">اكتب التشخيص هنا</label>
                        <input type="text" id="diagnosis-${item.id}" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-indigo-500 transition duration-150" placeholder="Diagnosis..." oninput="clearStatus(${item.id})">
                    </div>
                    <button onclick="checkDiagnosis(${item.id}, '${item.correctDiagnosis.replace(/'/g, "\\'")}')" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 rounded-lg transition duration-300 shadow-md">تأكد من الاجابة</button>
                    <div id="status-${item.id}" class="mt-4 p-3 rounded-lg hidden transition-all duration-500"></div>
                </div>
            `).join('');

            appDiv.innerHTML = `
                <header class="bg-white shadow-md p-4 mb-4">
                    <div class="container mx-auto max-w-4xl text-center">
                        <h1 class="text-2xl md:text-3xl font-extrabold text-gray-800 logo-font uppercase tracking-wider">Abdulrahman Hassan</h1>
                    </div>
                </header>
                <main class="container mx-auto max-w-4xl p-4 md:p-8 flex-grow">
                    <div class="bg-white shadow-xl rounded-xl p-4 mb-8 border-t-4 border-teal-500">
                        <h2 class="text-center text-2xl font-bold text-gray-800 mb-2">غير مزاجك/ج اثناء التشخيص</h2>
                        <div class="flex flex-col space-y-3">
                            <p id="trackTitle" class="text-lg font-semibold text-teal-600 text-center truncate">...</p>
                            <div class="flex items-center space-x-2 w-full" dir="ltr">
                                <span id="currentTime" class="text-sm text-gray-600 min-w-[30px] text-right">0:00</span>
                                <input type="range" id="progressBar" min="0" max="100" value="0" step="0.1" onchange="seek(this.value)" class="flex-grow h-1 bg-gray-300 rounded-lg appearance-none cursor-pointer accent-teal-500">
                                <span id="duration" class="text-sm text-gray-600 min-w-[30px] text-left">0:00</span>
                            </div>
                            <div class="flex justify-center items-center space-x-4">
                                <button onclick="skipTime(-10)" class="p-2 text-teal-500 bg-teal-100 rounded-full hover:bg-teal-200"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 14l9-5-9-5-9 5 9 5z"></path></svg></button>
                                <button onclick="playPrev()" class="p-2 text-gray-600 hover:text-teal-500"><svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24"><path d="M18 19L18 5L15 8V16L18 19ZM6 12L15 5V19L6 12Z"/></svg></button>
                                <button id="playPauseButton" onclick="togglePlayPause()" class="p-3 bg-teal-500 text-white rounded-full shadow-lg hover:bg-teal-600 transition duration-150 transform hover:scale-105"></button>
                                <button onclick="playNext()" class="p-2 text-gray-600 hover:text-teal-500"><svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24"><path d="M6 19L6 5L9 8V16L6 19ZM18 12L9 19V5L18 12Z"/></svg></button>
                                <button onclick="skipTime(10)" class="p-2 text-teal-500 bg-teal-100 rounded-full hover:bg-teal-200"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 14l9-5-9-5-9 5 9 5z"></path></svg></button>
                            </div>
                        </div>
                    </div>
                    <h2 class="text-3xl font-bold text-gray-800 mb-8 text-center">اختبار تشخيص الصور</h2>
                    <div class="grid gap-8 md:grid-cols-2">${quizHTML}</div>
                    <div id="quizSummary" class="mt-10 p-5 bg-yellow-100 border-l-4 border-yellow-500 rounded-lg text-center font-medium text-gray-700 hidden"></div>
                </main>
            `;
            updatePlayerUI();
        }

        function checkDiagnosis(id, correctDiagnosis) {
            const inputElement = document.getElementById(`diagnosis-${id}`);
            const statusDiv = document.getElementById(`status-${id}`);
            const cardDiv = document.getElementById(`card-${id}`);
            const userInput = inputElement.value.trim();
            if (!userInput) {
                statusDiv.className = 'mt-4 p-3 rounded-lg bg-red-100 text-red-800 block';
                statusDiv.innerHTML = `<p class="font-bold">الرجاء إدخال تشخيص أولاً.</p>`;
                return;
            }
            const normalize = (text) => text.toLowerCase().replace(/[\s\W_]/g, '').trim(); 
            const normalizedCorrect = normalize(correctDiagnosis);
            const normalizedUser = normalize(userInput);
            let isCorrect = (normalizedUser === normalizedCorrect) || (normalizedCorrect.includes(normalizedUser) && normalizedUser.length > 5);
            if (isCorrect) {
                results[id] = true;
                statusDiv.className = 'mt-4 p-3 rounded-lg bg-green-100 text-green-800 block border-l-4 border-green-500';
                statusDiv.innerHTML = `<p class="font-bold">✅ أحسنت! التشخيص صحيح.</p>`;
                cardDiv.classList.add('opacity-70', 'pointer-events-none');
                inputElement.disabled = true;
            } else {
                results[id] = false;
                statusDiv.className = 'mt-4 p-3 rounded-lg bg-red-100 text-red-800 block border-l-4 border-red-500';
                statusDiv.innerHTML = `<p class="font-bold">❌ التشخيص خاطئ.</p><p>التشخيص الصحيح: <span class="text-red-900 font-bold">${correctDiagnosis}</span></p>`;
            }
            updateQuizSummary();
        }

        function clearStatus(id) { document.getElementById(`status-${id}`).classList.add('hidden'); }

        function updateQuizSummary() {
            const totalItems = quizData.length;
            const correctCount = Object.values(results).filter(r => r === true).length;
            const summaryDiv = document.getElementById('quizSummary');
            if (Object.keys(results).length === totalItems) {
                summaryDiv.classList.remove('hidden');
                summaryDiv.innerHTML = `<p class="text-xl font-bold">ملخص الاختبار:</p><p class="mt-1">النتائج: ${correctCount} من أصل ${totalItems}.</p>`;
            }
        }

        window.onload = renderGateScreen;
    </script>
</body>
</html>

